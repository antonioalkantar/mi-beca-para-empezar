<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/default.xhtml">

	<ui:define name="content">
		<h:form id="formBandejaValidacion" styleClass="bandeja-validacion">
			<div class="contenido-general">
				<div class="custom-container">
					<p:panelGrid id="pnlGeneral" columns="1"
						columnClasses="ui-grid-col-12" layout="grid"
						style="text-align: center;"
						styleClass="ui-panelgrid-blank ui-fluid">
						<p:outputPanel styleClass="panel mt-4">
							<p:outputPanel styleClass="panel-header">
								<h1 class="panel-title">Validaciones</h1>
							</p:outputPanel>
							<p:outputPanel styleClass="panel-body">
								<p:panelGrid columns="2"
									columnClasses="ui-grid-col-7, ui-grid-col-5" layout="grid"
									styleClass="ui-panel-sin-pading ui-panelgrid-blank ui-fluid mb-5">
									<p:panelGrid columns="2"
										columnClasses="ui-grid-col-6, ui-grid-col-6" layout="grid"
										styleClass="ui-panelgrid-blank ui-fluid"
										style="text-align:center !important; padding-right: 20px !important;">
										<p:panelGrid columns="2"
											columnClasses="ui-grid-col-6, ui-grid-col-6" layout="grid"
											styleClass="ui-panelgrid-blank ui-fluid">
											<p:outputLabel value="Ciclo escolar:"
												styleClass="w-full h-full flex justify-content-center align-items-center label-filtro" />
											<p:selectOneMenu id="selCicloEscolar"
												value="#{bandejaValidacionBean.idCicloEscolar}">
												<f:selectItems
													value="#{bandejaValidacionBean.lstCatCicloEscolarDTO}"
													var="cicloEscolar" itemLabel="#{cicloEscolar.descripcion}"
													itemValue="#{cicloEscolar.idCicloEscolar}"></f:selectItems>
											</p:selectOneMenu>
										</p:panelGrid>
										<p:panelGrid columns="2"
											columnClasses="ui-grid-col-6, ui-grid-col-6" layout="grid"
											styleClass="ui-panelgrid-blank ui-fluid">
											<p:outputLabel value="Periodo"
												styleClass="w-full h-full flex justify-content-center align-items-center label-filtro" />
											<p:selectOneMenu id="selPeriodoEscolar"
												value="#{bandejaValidacionBean.idPeriodoEscolar}">
												<f:selectItems
													value="#{bandejaValidacionBean.lstCatPeriodoEscolarDTO}"
													var="periodoEscolar"
													itemLabel="#{periodoEscolar.descripcion}"
													itemValue="#{periodoEscolar.idPeriodoEscolar}"></f:selectItems>
											</p:selectOneMenu>
										</p:panelGrid>
									</p:panelGrid>
									<p:panelGrid columns="2"
										columnClasses="ui-grid-col-8, ui-grid-col-4" layout="grid"
										styleClass="ui-panelgrid-blank ui-fluid total-beneficiarios ml-5">
										<p:outputLabel value="TOTAL DE BENEFICIARIOS A VALIDAR:" />
										<p:outputLabel
											value="#{bandejaValidacionBean.cantidadBeneficiarios}"
											styleClass="w-full flex total-beneficiarios-cant" />
									</p:panelGrid>
								</p:panelGrid>

								<p:panelGrid columns="1" columnClasses="ui-grid-col-12"
									layout="grid"
									styleClass="ui-panelgrid-blank ui-fluid mb-5 text-center">
									<p:commandButton value="Ejecutar Validación" process="@form"
										update="@form"
										action="#{bandejaValidacionBean.ejecutarValidacion()}"
										styleClass="adip-btn-green" />
								</p:panelGrid>

								<p:panelGrid columns="1" columnClasses="ui-grid-col-12"
									layout="grid"
									styleClass="ui-panelgrid-blank ui-fluid text-center mb-3 mt-1">
									<p:outputLabel styleClass="titulo-tabla"
										value="Historial de validaciones realizadas" />
								</p:panelGrid>

								<p:panelGrid columns="2"
									columnClasses="ui-g-12 ui-md-12 ui-lg-10, ui-g-12 ui-md-12 ui-lg-2"
									layout="grid"
									styleClass="ui-panel-sin-pading ui-panelgrid-blank ui-fluid filtro-tabla mb-3 mt-5">
									<p:panelGrid columns="4"
										columnClasses="ui-grid-col-3, ui-grid-col-3, ui-grid-col-3, ui-grid-col-3"
										layout="grid" styleClass="pnl-filtro">
										<p:panelGrid columns="2"
											columnClasses="ui-grid-col-6, ui-grid-col-6" layout="grid"
											styleClass="ui-panel-sin-pading ui-panelgrid-blank ui-fluid"
											style="text-align:center !important; padding-left: 0px !important;">
											<p:outputLabel value="Ciclo escolar"
												styleClass="label-filtro" />
											<p:selectOneMenu>
												<f:selectItems
													value="#{bandejaValidacionBean.lstCatCicloEscolarDTO}"
													var="cicloEscolar" itemLabel="#{cicloEscolar.descripcion}"
													itemValue="#{cicloEscolar.idCicloEscolar}"></f:selectItems>
											</p:selectOneMenu>
										</p:panelGrid>
										<p:panelGrid columns="2"
											columnClasses="ui-grid-col-4, ui-grid-col-8" layout="grid"
											styleClass="ui-panelgrid-blank ui-fluid"
											style="text-align:center !important; padding-left: 0px !important;">
											<p:outputLabel value="Periodo" styleClass="label-filtro" />
											<p:selectOneMenu>
												<f:selectItems
													value="#{bandejaValidacionBean.lstCatPeriodoEscolarDTO}"
													var="periodoEscolar"
													itemLabel="#{periodoEscolar.descripcion}"
													itemValue="#{periodoEscolar.idPeriodoEscolar}"></f:selectItems>
											</p:selectOneMenu>
										</p:panelGrid>
										<p:panelGrid columns="2"
											columnClasses="ui-grid-col-4, ui-grid-col-8" layout="grid"
											styleClass="ui-panelgrid-blank ui-fluid"
											style="text-align:center !important; padding-left: 0px !important;">
											<p:outputLabel value="Tipo" styleClass="label-filtro" />
											<p:selectOneMenu>
												<f:selectItems
													value="#{bandejaValidacionBean.lstCatTipoDispersionDTO}"
													var="tipoDispersion"
													itemLabel="#{tipoDispersion.descripcion}"
													itemValue="#{tipoDispersion.idTipoDispersion}"></f:selectItems>
											</p:selectOneMenu>
										</p:panelGrid>
										<p:panelGrid columns="2"
											columnClasses="ui-grid-col-4, ui-grid-col-8" layout="grid"
											styleClass="ui-panelgrid-blank ui-fluid">
											<p:outputLabel value="Estatus" styleClass="label-filtro" />
											<p:selectOneMenu>
												<f:selectItems
													value="#{bandejaValidacionBean.lstCatEstatusDispersionDTO}"
													var="estatusDispersion"
													itemLabel="#{estatusDispersion.descripcion}"
													itemValue="#{estatusDispersion.idEstatusDispersion}"></f:selectItems>
											</p:selectOneMenu>
										</p:panelGrid>
									</p:panelGrid>
									<p:outputPanel
										styleClass="pnl-btn flex justify-content-end align-items-center h-full ml-4">
										<p:commandButton style="margin:0 !important" value="Buscar"
											styleClass="adip-btn-green" immediate="true" />
										<p:commandButton style="margin:0 0 0 20px !important"
											value="Limpiar" styleClass="adip-btn-white-2"
											immediate="true" />
									</p:outputPanel>
								</p:panelGrid>

								<p:dataTable styleClass="dt-tramites" reflow="true" rows="10"
									paginator="true" paginatorPosition="bottom"
									value="#{bandejaValidacionBean.dispersiones}" var="dispersion"
									paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
									currentPageReportTemplate="Mostrados {startRecord}-{endRecord} de {totalRecords} resultados">
									<p:column headerText="Ciclo escolar" width="20%"
										style="vertical-align: middle;">
										<p:outputLabel
											value="#{dispersion.catCicloEscolar.descripcion}" />
									</p:column>
									<p:column headerText="Periodo" width="20%"
										style="vertical-align: middle;">
										<p:outputLabel
											value="#{dispersion.catPeriodoEscolar.descripcion}" />
									</p:column>
									<p:column headerText="Tipo" width="20%"
										style="vertical-align: middle;">
										<p:outputLabel
											value="#{dispersion.catTipoDispersion.descripcion}" />
									</p:column>
									<p:column headerText="No. de beneficiarios" width="20%"
										style="vertical-align: middle;">
										<p:outputLabel value="#{dispersion.numBeneficiarios}" />
									</p:column>
									<p:column headerText="Estatus" width="20%"
										style="vertical-align: middle;">
										<p:outputLabel
											value="#{dispersion.catEstatusDispersion.descripcion}" />
									</p:column>
									<p:column headerText="Fecha de ejecución" width="20%"
										style="vertical-align: middle;">
										<p:outputLabel value="#{dispersion.fechaEjecucion}" />
									</p:column>
									<p:column headerText="Fecha de conclusión" width="20%"
										style="vertical-align: middle;">
										<p:outputLabel value="#{dispersion.fechaConclusion}" />
									</p:column>
									<p:column headerText="Aplica la dispersión (%)" width="20%"
										style="vertical-align: middle;">
										<p:outputLabel
											value="#{dispersion.aplicaDispersionPorcentaje}" />
									</p:column>
									<p:column headerText="No aplica la dispersión (%)" width="20%"
										style="vertical-align: middle;">
										<p:outputLabel
											value="#{dispersion.noAplicaDispersionPorcentaje}" />
									</p:column>
									<p:column headerText="Acciones" width="20%"
										style="vertical-align: middle;">
									</p:column>
									<p:column headerText="Fecha de descarga" width="20%"
										style="vertical-align: middle;">
										<p:outputLabel value="#{dispersion.fechaDescarga}" />
									</p:column>
								</p:dataTable>
							</p:outputPanel>
						</p:outputPanel>
					</p:panelGrid>
				</div>
			</div>


			<p:dialog widgetVar="dlgConfirmacion"
				header="Confirmar validación complementaria" modal="true"
				width="500px" responsive="true" resizable="false"
				styleClass="dlg-confirmacion" closable="false">
				<p:outputPanel>
					<p class="text-center">
						Será realizada la validación <b>#{bandejaValidacionBean.mensajeTipoValidacion}</b>
						para el periodo de <b>#{bandejaValidacionBean.obtenerDescripcionPeriodo()}</b>
						del ciclo escolar <b>#{bandejaValidacionBean.obtenerDescripcionCiclo()}</b>
					</p>
					<p class="my-4 text-center">¿Deseas confirmar la acción?</p>
				</p:outputPanel>
				<p:outputPanel
					styleClass="flex justify-content-center align-items-center mt-3">
					<p:commandButton style="margin:0 !important" value="Confirmar"
						update="@form"
						action="#{bandejaValidacionBean.insertarDispersion()}"
						styleClass="adip-btn-green" immediate="true" />
					<p:commandButton style="margin:0 0 0 20px !important"
						onclick="PF('dlgConfirmacion').hide();" value="Cancelar"
						styleClass="adip-btn-white-2" immediate="true" />
				</p:outputPanel>
			</p:dialog>

			<p:dialog widgetVar="dlgValidacion"
				header="¡Validación en proceso!" modal="true"
				width="500px" responsive="true" resizable="false"
				styleClass="dlg-confirmacion" closable="false">
				<p:outputPanel>
					<p class="text-center">
						Existe una validación en curso, por lo que no es posible ejecutar una nueva validación.
					</p>
				</p:outputPanel>
				<p:outputPanel
					styleClass="flex justify-content-center align-items-center mt-3">
					<p:commandButton style="margin:0 0 0 20px !important"
						onclick="PF('dlgValidacion').hide();" value="Entendido"
						styleClass="adip-btn-white-2" immediate="true" />
				</p:outputPanel>
			</p:dialog>

		</h:form>
	</ui:define>
</ui:composition>